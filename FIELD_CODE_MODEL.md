# フィールドコード規格策定モデル

## 目的
ぷよぷよ系連鎖シミュレーター間で盤面データ（フィールドコード）の互換性を高めるため、主要な実装例とAI解析結果をもとに標準化モデルを策定する。

---

## 1. 主要シミュレーターのフィールドコード仕様

### 1.1 puyosimulator_pndsng.com（pndsng.com）
- **盤面サイズ**: 13行 × 6列
- **データ構造**: 2次元配列 `map[y][x]`
- **エンコード方式**: RLE圧縮＋a〜kの1文字表現
    - 例: `bbbbbcc...`（a:空白, b:赤, c:青, ...）
    - 連続する同じ色は「文字＋数字」で圧縮
- **デコード方式**: 文字＋数字の繰り返しで2次元配列に復元
- **色・特殊ブロック割当**:
    - RED=0, BLUE=1, YELLOW=2, GREEN=3, PURPLE=4, OJAMA=5, ... BLANK=11

### 1.2 puyopuyo_rensa-sim_puyop.com（puyop.com）
- **盤面サイズ**: 6列 × 12行
- **データ構造**: 2次元配列
- **エンコード方式**: 62進数文字列（`0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ[]`）
    - 1文字6ビット分の情報（FCODE_CHAR_BIT=6）
    - 盤面以外にもNEXTやなぞぷよ条件などもFCODEに含められる設計
- **色・特殊ブロック割当**:
    - TYPE_AKA=1, TYPE_MIDORI=2, TYPE_AO=3, TYPE_KI=4, TYPE_MURASAKI=5, TYPE_OJAMA=6, ...

### 1.3 ChatGPT・Geminiによる解析ドキュメント
- どちらも「2次元配列→文字列化→RLE圧縮 or 固定長エンコード」という流れを指摘
- 色や特殊ブロックの割り当て、盤面サイズ、エンコード方式の違いも指摘

---

## 2. 共通点と差異

### 共通点
- 盤面は2次元配列（6×12または13×6）で管理
- 色や特殊ブロックは数値または文字で割り当て
- フィールドコードは「文字列化＋圧縮（RLEや62進数）」で表現
- encode/decode関数で相互変換

### 差異
- 盤面サイズ（6×12 vs 13×6）
- エンコード方式（RLE圧縮 vs 固定長62進数）
- 色・特殊ブロックの割り当て値
- 盤面以外の情報（NEXT, なぞぷよ条件等）の有無

---

## 3. 標準化モデル案

### 3.1 盤面サイズ
- **推奨**: 6列×12行（ぷよぷよ通準拠）
- **拡張**: 13行×6列も許容し、相互変換可能な設計

### 3.2 色・ブロック割当
| 色・ブロック | 推奨値 | 備考 |
|:---|:---|:---|
| 空白         | 0   | None/BLANK |
| 赤           | 1   | TYPE_AKA/RED |
| 緑           | 2   | TYPE_MIDORI/GREEN |
| 青           | 3   | TYPE_AO/BLUE |
| 黄           | 4   | TYPE_KI/YELLOW |
| 紫           | 5   | TYPE_MURASAKI/PURPLE |
| おじゃま     | 6   | TYPE_OJAMA/OJAMA |
| その他特殊   | 7以降| KATA, TETSU, ... |

### 3.3 エンコード方式
- **推奨**: 固定長62進数文字列（1文字6ビット）
    - 盤面情報のみの場合は72文字（6×12）
    - RLE圧縮方式もサブセットとして許容
- **拡張**: NEXTやなぞぷよ条件等の追加情報も拡張領域で表現可能

### 3.4 相互変換関数
- encode(map) / decode(code) の標準インターフェースを定義
- 主要シミュレーターの方式間で相互変換可能なマッピング表を用意

---

## 4. 今後の展望
- 主要シミュレーター間でのフィールドコード互換性向上
- 追加情報（NEXT, なぞぷよ条件等）の標準化も検討
- 本モデルをVer.1.10以降の実装・ドキュメントに反映