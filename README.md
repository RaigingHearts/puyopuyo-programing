# ぷよぷよプログラミング一式実装
このリポジトリは、SEGAとMonaca Educationで協賛されているプログラミング学習教材を指示通りに実装したものです。
## 注意事項
コード内容や画像リソースはSEGAによりライセンスが管理されています。  
## 資料一覧
[公式ホームページ](https://puyo.sega.jp/program_2020/)<br>
[プログラムコードの全文教本](https://puyo.sega.jp/program_2020/dl/puyo-programming-code.pdf)<br>
[プログラミング学習小冊子](https://puyo.sega.jp/program_2020/dl/puyo-programming-booklet.pdf)<br>
## ライセンス
SEGA<br>
Monaca Education<br>

## プログラム内容の改修に関するルール
* コメント文章やコメントアウトされたコードをファイル内容から消去することは厳格に禁ずる。
* コードの内容を変更する場合、変更前のコードをコメントアウトなどで厳密に保持すること。
* コードの変更、追加、削除などの操作は、手を加えた部分が明確になるようにコメント処理をする。

## コーディングエージェントAIへの伝達事項
1. Github管理の取り決め
    * エージェントが作業するブランチとして、それぞれのエージェント専用の分岐ブランチを作成する。
    * エージェント専用の分岐ブランチの名称は`<コーディングAIの名称>/workingbranch`の命名規則に従う。
    * エージェント用の分岐ブランチ「`<コーディングAIの名称>/workingbranch`」を親として使用する。
    * エージェントが作業用ブランチとして確保するブランチは常に一つにして、いくつもブランチを作らないようにする。
    * エージェントとのコミュニケーションチャットなどのタイトル名をブランチ用の名称に使用することは禁止する。（ブランチの名称文字数が長くなりすぎるため）
    * エージェント側でブランチ識別子用のランダム文字列付与が必要な場合、親ブランチの配下に新たな分岐を作成して、その名称に識別子付きの名称設定を行う。
    * 識別子をつけた配下のブランチは、マージ作業を完了したら削除を行って、ブランチリストに残さないようにする。
    * プルリクエストをオーナーへ伝達する際は、エージェント専用の分岐ブランチを参照するように申し伝える。
### GithubリポジトリにあるコーディングエージェントAI専用のブランチリスト（新しいエージェントが分岐作業をしたらこの項目に記載すること）
1. CursorAgent専用ブランチ
    * Cursor/workingbranch

## ぷよぷよステージ表示のサイズ調整
Cursorによる調整箇所の案内をここに記す。
### 🔧 今後の表示サイズ調整が必要な場合の調整箇所案内
ローカルGITに同期した後で、さらなる表示サイズ調整が必要になった場合は、以下の箇所を修正してください：

1. メインのサイズ調整
ファイル: src/config.js 行: 11行目
```js
// 現在: 0.97（3%縮小）
Config.puyoImgHeight = (window.innerHeight-Config.fontHeight)/Config.stageRows * 0.97

// さらに縮小したい場合の例:
// 5%縮小: * 0.95
// 7%縮小: * 0.93
// 拡大したい場合の例:
// 2%拡大: * 1.02
```
2. NEXTエリアのサイズ調整
ファイル: index.html 行: 40-41行目
```js
<!-- 現在: 78px -->
<div id="next-puyo-1" style="width: 78px; height: 78px;">
<div id="next-puyo-2" style="width: 78px; height: 78px;">

<!-- 調整例: 
     さらに小さく → 75px
     少し大きく → 80px -->
```
3. NEXTぷよ内の位置調整
ファイル: src/nextpuyo.js 行: 73-83行目
```js
// 現在の設定
centerPuyoImg.style.left = '19px';
centerPuyoImg.style.top = '39px';
movablePuyoImg.style.left = '19px';

// 調整指針:
// NEXTエリアを75pxにした場合: left = '17px', top = '37px'
// NEXTエリアを80pxにした場合: left = '20px', top = '40px'
// 計算式: (新しいサイズ / 78) × 現在の値
```
4. フォントサイズの調整（必要に応じて）
ファイル: src/config.js 行: 6行目
```js
Config.fontHeight = 33; // スコア表示エリアの高さ

// 小さくしたい場合: 30
// 大きくしたい場合: 36
```
### 🎯 調整の目安
* 縮小が必要: 係数を0.95, 0.93, 0.90など小さくする
* 拡大が必要: 係数を1.00, 1.03, 1.05など大きくする
* NEXTエリア: メインサイズに比例させるか、独立して調整
* 位置調整: NEXTエリアサイズに比例させる


これで、必要に応じて細かな調整が可能です！

## プログラムの改修履歴
プログラムコードの全文教本からファイル作成した本リポジトリを基礎コードとして、改修を行った履歴を記録する。
* プログラムの改修履歴項目の追記の取り決め
    * Ver.への改修作業で取り組んだ内容を記録するための追記を行う。
    * 改修履歴の内容は、当該項目のフォーマットに沿った記述を行う。
    * 「* <以下、改修された履歴を追記する>」の箇条書きは、今後の改修作業によって追記されることを見越したものなので、項目内から除去することを禁止する。
    * 「* <以下、改修された履歴を追記する>」の箇条書きのレベルに、改修履歴の内容を追記する。
    * 「* <以下、改修された履歴を追記する>」の箇条書きは、常に箇条書き内の最後尾に位置させる。
* Ver.1.0
    * 基礎コードでのプログラム作成と初期コミット
* Ver.1.1
    * NEXTぷよ（次に出現するピース）の告知表示機能を追加
    * NEXTぷよの表示場所: 盤面右側
    * NEXTぷよの表示数: 二つ先のピースまで表示
    * 追加・修正ファイル：
      - index.html: NEXTぷよ表示エリアの追加
      - src/nextpuyo.js: NEXTぷよ管理クラスの新規作成
      - src/game.js: NEXTぷよ初期化処理の追加
      - src/player.js: NEXTぷよシステムとの連携処理の追加
* Ver.1.2
    * 操作キーの機能変更と新規追加
    * 操作キーの機能変更: 上矢印キー（↑）を回転からぷよピースの落下ストップ機能に変更
    * 新規キー操作の追加: ぷよピースの回転方向操作キーを追加
      - Aキー: 左回り（反時計回り）回転
      - Dキー: 右回り（時計回り）回転
    * 上矢印キーでストップ中でも回転操作が可能
    * 修正ファイル：
      - src/player.js: キー操作処理の全面改修
* Ver.1.3
    * ウェブページ背景と盤面背景の視覚的区切り分けとスコア表示位置の修正
    * 視覚的区切りの追加：
      - ウェブページ背景色を薄いグレー（#f0f0f0）に変更
      - 盤面エリアを白い背景で囲み、濃い枠と影を追加
      - 盤面自体にも枠を追加して明確な区切りを作成
      - NEXTぷよエリアにも背景色と角丸枠を追加
    * スコア表示位置の修正：
      - 盤面とNEXTエリアを含む全体レイアウトを見直し
      - スコアを盤面コンテナの下に適切に配置
      - スコア表示も独立した枠付きエリアとして表示
    * 修正ファイル：
      - index.html: HTMLレイアウトの全面改修
      - src/stage.js: スコア表示位置設定の調整
* Ver.1.4
    * 盤面表示サイズの調整
    * 盤面全体の表示サイズを3%縮小（0.97倍）：
      - ページの縦範囲を短縮してスクロールなしでスコア表示を確認可能にする
      - 盤面のぷよサイズを3%縮小
      - NEXTぷよエリアのサイズも連動して調整（80px → 78px）
      - NEXTぷよ内の表示位置も比例調整
    * RaigingHeartsによるさらなる調整：
      * 盤面全体の表示サイズ「3%縮小（0.97倍）」から0.85倍へさらに縮小した
      * 教本内の初期コード全文からCursorによる改修を経たコンフィグ内の計算設定から推測し、おそらく初期コードデフォルトの表示サイズであろう倍率数値をコンフィグの変更箇所コメントに記載した。
      * NEXTぷよの表示位置を微調整（MovablePuyo（上にあるぷよ）left:15 top:0）（centerpuyo（下にあるぷよ）left:15 top:30）
    * 修正ファイル：
      - src/config.js: 盤面サイズの計算式を調整
      - index.html: NEXTエリアの固定サイズ調整
      - src/nextpuyo.js: NEXTぷよ表示位置の調整
* Ver.1.5
    * 幽霊ぷよ（ゴーストピース）機能の追加
    * 幽霊ぷよ機能の実装：
      - 現在操作中のぷよピースが着地するであろう位置を予測表示
      - 透過した見た目（透明度30%）で着地点にぷよピースを表示
      - リアルタイムでの位置更新（移動・回転・落下に連動）
      - ピース確定時の自動削除
    * 技術的な実装：
      - 落下シミュレーション計算による着地点予測
      - 障害物検知と衝突判定
      - 透明度設定による視覚的な区別
    * 修正ファイル：
      - src/config.js: 幽霊ぷよの透明度設定を追加
      - src/player.js: 幽霊ぷよ機能の全面実装
      - index.html: バージョン表示の更新
* Ver.1.6
    * レフトサイドメニューとカスタム盤面編集機能の追加
    * レフトサイドメニューの実装：
      - レスポンシブ対応のサイドメニューを追加
      - カスタム盤面、データ管理、連鎖プレビューのセクション分け
      - 保存済みデータの一覧表示と管理機能
    * カスタム盤面編集機能：
      - custom.htmlによる独立した盤面編集画面の実装
      - ぷよパレットによる直感的な盤面編集
      - 連鎖の種プリセットと大連鎖プリセットの配置機能
      - フィールドコードによる盤面の保存・読み込み
    * 連鎖プレビュー機能：
      - 現在の盤面から連鎖を自動シミュレーション
      - ステップ連鎖による連鎖の段階的確認
      - 連鎖スコアの詳細表示と計算
    * データ管理機能：
      - フィールドコードによるクッキーデータストック
      - 保存データの名称選択と読み込み
      - 外部ウェブページのフィールドコード読み込み
      - メイン盤面への適用機能
    * 修正ファイル：
      - index.html: レフトサイドメニューの実装とレイアウト変更
      - src/sidemenu.js: サイドメニュー機能の管理クラス新規作成
      - src/chain.js: 連鎖プレビューとシミュレーション機能の新規作成
      - custom.html: カスタム盤面編集専用画面の新規作成
* Ver.1.7
    * Ver.1.6で実装予定とした機能の完全実装
    * 自動再生機能の実装：
      - 連鎖プレビューに自動再生機能を追加
      - 再生/停止の切り替え可能
      - 1.5秒間隔での自動ステップ進行
      - 最後のステップまで行ったら最初に戻るループ機能
    * カスタムエディター連鎖プレビューの実装：
      - カスタム盤面編集画面での連鎖シミュレーション機能
      - 落下処理と消去判定の完全実装
      - 連鎖スコア計算とステップ詳細表示
      - 連鎖結果のポップアップ表示機能
    * 修正ファイル：
      - src/chain.js: 自動再生機能の完全実装
      - custom.html: 連鎖プレビュー機能の完全実装
      - index.html: バージョン表示の更新
* Ver.1.8
    * 細部の修正作業と機能改善
    * 落下コントロールボタンの追加：
      - 上矢印キーでの落下一時停止機能を保持
      - メイン盤面に落下停止・再開ボタンを追加
      - 長考時のキー押し続けの必要性を解消
    * ばたんきゅー後のキー変更とUI改善：
      - リロードキーを上矢印キーからスペースキーに変更
      - 「コンティニュー<SPACE KEY>」案内テキストの表示追加
      - ばたんきゅー画面での視覚的案内の向上
    * カスタム盤面編集の操作性向上：
      - 保存データ読み込みを一覧選択形式に変更
      - 外部フィールドコード読み込み機能をカスタム編集内に追加
      - モーダルダイアログによる直感的な操作
    * ゲームループ管理の改善：
      - カスタム盤面データのメイン盤面読み込み時の初期化処理追加
      - ゲーム状態の完全リセット機能
      - プレイヤー操作状態のクリーンアップ
    * テスト用17連鎖プリセットの追加：
      - 高難度連鎖のテスト用プリセット追加
      - 動作検証とデバッグ用途に活用可能
    * 修正ファイル：
      - src/player.js: 落下コントロール機能とスペースキー対応
      - src/puyoimage.js: ばたんきゅー時のテキスト表示機能
      - src/sidemenu.js: ゲームループ初期化機能
      - custom.html: 操作性向上とUI改善
      - index.html: 落下コントロールボタンの追加
* Ver.1.9
    * 追加の細部修正作業
    * **コンティニュー案内テキストの改行修正**：
      - "コンティニュー<SPACE KEY>"から"コンティニュー<br><SPACE KEY>"に変更
      - ばたんきゅー画面での視認性向上
    * **カスタム盤面読み込み時の制御フロー改善**：
      - 制御順序を「ループ処理初期化→カスタムデータ読み込み→コントロール制御停止状態」に変更
      - 盤面データ読み込み後の自動操作停止機能追加
    * **メイン盤面での連鎖プレビュー機能の本格実装**：
      - カスタム編集画面：テキスト表示による静的プレビュー（従来通り）
      - メイン盤面：実際の盤面で動的に表示する新方式
      - 消去対象ぷよのハイライト表示
      - 小型UIパネルによる操作（前/次/自動/終了ボタン）
      - プレビュー終了時の元状態復旧機能
      - プレビューモード中のゲームループ停止
    * **実装技術詳細**：
      - プレビュータイプ分岐（'modal'/'main'）
      - 元盤面状態の保存・復旧システム
      - 動的CSS注入によるアニメーション効果
      - ボタンID選択機能（プレビュータイプ対応）
    * 修正ファイル：
      - index.html: コンティニューテキスト改行修正
      - src/sidemenu.js: カスタム盤面読み込み制御フロー改善
      - src/chain.js: メイン盤面動的プレビューシステム全面実装
* Ver.1.10
    * フィールドコード規格策定モデルの策定・ドキュメント追加
    * フィールドコード出力形式の選択・エクスポート機能追加（標準形式/puyop.com/pndsng.com互換）
    * データ管理セクションのUI改善（「保存データ一覧・読み込み」ラベル等）
    * 全消し演出の表示ウェイトをConfigで設定し、一定時間後に非表示にするロジックへ修正
    * 細部のバグ修正・リファクタリング
    * 修正ファイル：
      - FIELD_CODE_MODEL.md: フィールドコード規格策定ドキュメント新規作成
      - index.html: 出力形式選択UI・ボタン追加、ラベル改善
      - src/sidemenu.js: 出力形式エンコード・UI制御追加
      - src/game.js: 全消し演出ウェイト・非表示ロジック
      - src/config.js: 全消し演出ウェイト設定追加
* Ver.1.11
    * メイン盤面プレビューモード遷移の制御改善（0連鎖目からステップ表示）
    * サイドメニューの保存済みデータ表示セクションを除去し、保存データ一覧ボタンからのみアクセス可能に変更
    * UI整理・連鎖プレビューのハイライト表現統一
    * 保存データ一覧の読み込みボタン・サイドメニュー各種ボタンのクリック不具合修正
    * その他細かなUX改善・バグ修正
    * 修正ファイル：
      - index.html: サイドメニューUI整理
      - src/sidemenu.js: 保存データ一覧・ボタン不具合修正
      - src/chain.js: 連鎖プレビュー制御改善
      - README.md: 改修履歴追記
* Ver.1.12
    * カスタム盤面エディタの「メイン盤面に適用」ボタンと実装を除去
    * 機能重複の解消（保存→読み込みフローで代替可能）
    * UIの簡素化と保守性向上
    * 修正ファイル：
      - custom.html: メイン盤面適用ボタン・applyToMainメソッド除去
* Ver.1.13
    * カスタム盤面編集ウィンドウの重複防止・フォーカス機能追加
    * 17連鎖階段積みデータを参考にした実用的なプリセット改善
    * 連鎖の種・階段積み連鎖・実戦連鎖・高難度連鎖の体系化
    * 生成AIのぷよぷよ連鎖理解力テストケースの充実
    * プリセットデータをConfig側に移動し、一元管理を実現
    * 17連鎖ステップの1連鎖プリセット（自由落下前配置）を追加
    * 通常プリセットをテンプレート化し、他利用者のカスタマイズを促進
    * 17連鎖ステップ順列（1-17連鎖）の完全実装
    * プリセット選択時の詳細表示UIを統一し、フィールドコード確認機能を追加
    * 修正ファイル：
      - src/sidemenu.js: ウィンドウ重複防止・プリセット改善・UI更新・詳細表示機能追加
      - custom.html: プリセットデータ改善
      - src/config.js: プリセットデータ移動・テンプレート化・17連鎖ステップ順列追加
* ＜以下、改修された履歴を追記する＞
