以下は、**puyop.com** および **pndsng.com** における「ぷよフィールドコード」仕様を比較整理した **仕様解析文書（Markdown形式）** です。
それぞれの **コード構成・エンコード前の符号化仕様・圧縮方式・拡張構造（NEXT・なぞぷよ等）** も含めて網羅しています。

---

# ぷよぷよ連鎖シミュレーター解析によるフィールドコード仕様

## 対象サイト
- [puyop.com/s](https://www.puyop.com/s/)
- [pndsng.com/puyo](https://www.pndsng.com/puyo/)

---

## 🧩 1. 共通仕様概要

| 項目         | 内容                       |
|--------------|----------------------------|
| フィールド   | 6列 × 13行（78マス）       |
| 記述形式     | URLクエリ文字列に埋め込み  |
| 目的         | フィールド状態の保存／共有／読込 |
| 圧縮方式     | サイトにより異なる（詳細下記） |
| NEXTぷよ     | 拡張部あり（puyop.com, pndsng.com） |
| なぞぷよ条件 | 拡張部あり（puyop.com のみ） |

---

## 🟦 2. エンコード前のコード表記（符号化仕様）

ぷよの種別を1マス1文字で表現する **シンボルコード** についての定義。

### 🅰 puyop.com の記号一覧（推定）

| 種別        | 数値 | 意味         |
|-------------|------|--------------|
| `0`         | 0    | 空白         |
| `1`〜`5`    | 1〜5 | 色ぷよ（赤〜紫）|
| `6`         | 6    | おじゃまぷよ |
| `7`         | 7    | かたぷよ     |
| `8`         | 8    | 鉄ぷよ（用途不明） |
| `9`         | 9    | 壁ブロック（固定）|
| `10`        | 10   | 消去対象ぷよ（内部使用）|

（※数値をビットで表現→6bitごとに `ENCODE_CHAR` を使ってエンコード）

---

### 🅱 pndsng.com の記号一覧（確定）

| 種別         | 定数     | 文字 | 備考             |
|--------------|----------|------|------------------|
| 空白         | BLANK    | `a`  | 空のマス         |
| 赤ぷよ       | RED      | `b`  |                  |
| 青ぷよ       | BLUE     | `c`  |                  |
| 黄ぷよ       | YELLOW   | `d`  |                  |
| 緑ぷよ       | GREEN    | `e`  |                  |
| 紫ぷよ       | PURPLE   | `f`  |                  |
| おじゃまぷよ | OZYAMA   | `g`  |                  |
| 黒ぷよ       | BLACK    | `h`  | 表示専用         |
| ブロック     | BLOCK    | `i`  | 固定ブロック     |
| 得点ぷよ     | TOKUTEN  | `j`  | 隣接ボーナス加点 |
| かたぷよ     | KATAPUYO | `k`  | 消すとおじゃま化 |
| 消去中ぷよ   | ERASE    | `a`  | 表示上は空白扱い |

---

## 📘 3. puyop.com の仕様

### 🔠 3.1 エンコード文字セット
```js
ENCODE_CHAR = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ[]';
```

* 64文字（6bit表現）
* 各ぷよを2bit〜4bitに圧縮し、まとめて6bit単位で符号化

### 📦 3.2 フィールド構造

* マス順は **左上 → 右 → 次行へ**（行優先）
* ぷよの色を数値で内部表現 → ビット列化 → 6bitずつ `ENCODE_CHAR` に変換

### 🧩 3.3 NEXTぷよ構造（ `_` 以降）

* 1手分 = 12bit
* 最大100手程度（推定）
* 色／位置／方向などを符号化して追加

### ❓ 3.4 なぞぷよ条件（ `-` 以降）

| 項目          | ビット数 |
| ----------- | ---- |
| 条件種別（例：連鎖数） | 4bit |
| 色指定         | 3bit |
| 数値（例：個数）    | 7bit |

---

## 📙 4. pndsng.com の仕様

### 🔠 4.1 エンコード文字定義（符号圧縮ではない）

* RLE（ランレングス圧縮）方式で圧縮
* 例：`aaaaabbbbccc` → `a5b4c3`

### 🧮 4.2 `encode(map)` の処理

1. 左上から `map[y][x]` を走査
2. 同じぷよが連続している場合、1文字＋個数（省略可）に変換
3. 最終文字列として返却（例：`b3c2a50`）

### 🧾 4.3 `decode(code)` の処理

1. 数字と文字を交互に読み取り
2. 文字 → 対応する定数に変換（マップへ展開）

### 🍪 4.4 Cookie保存（MemoryPanel）

* `"field"` キーにコード文字列
* `"name"` キーに付与名

---

## 🔄 5. コード文字列フォーマット例

### ✅ puyop.com（冗長コード + NEXT + 条件）

```
=abcdefgHIJKLMN_opqrstu-vwxyz
```

### ✅ pndsng.com（RLE圧縮コード）

```
b3c4a71
```

---

## 📌 6. 比較まとめ表

| 項目        | puyop.com            | pndsng.com    |
| --------- | -------------------- | ------------- |
| 圧縮方式      | Base64風ビット圧縮         | ランレングス圧縮（RLE） |
| NEXTぷよ対応  | あり `_` 以降            | あり `_` 以降     |
| なぞぷよ条件対応  | あり `-` 以降            | なし            |
| フィールド構造   | ビット列 → 6bit符号化       | 記号1文字＋繰返し数    |
| ぷよ種類の記号表現 | 数値（0〜10）             | 記号（a〜k）       |
| コード例      | `=a0b1c2..._...-...` | `b3c4a71`     |

---

## ✅ 補足・活用

* 両サイトとも URLクエリまたはCookieによりフィールド保存が可能。
* 自作アプリやAIによる連鎖解析において、これらのコード仕様を解析・利用することで、データ連携やトレーニングが可能になる。

---

## 🔧 付録：利用可能な記号（pndsng）

```text
a: 空白
b: 赤
c: 青
d: 黄
e: 緑
f: 紫
g: おじゃま
h: 黒
i: ブロック
j: 得点ぷよ
k: かたぷよ
```

---

必要に応じて：

- PDFやHTMLへの変換用テンプレートも提供可能です。
- 各種 `encode/decode` 関数をPythonまたはJavaScriptで再現するコードも生成可能です。

ご希望があればお知らせください。
